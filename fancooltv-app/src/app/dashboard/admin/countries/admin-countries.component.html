<div class="admin-countries-container">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Countries Management</h1>
    <button class="btn btn-primary" (click)="createCountry()">
      <i class="fas fa-plus me-2"></i>Add Country
    </button>
  </div>

  <!-- Search and Filters Card -->
  <div class="card search-filter-card mb-4">
    <div class="card-body">
      <div class="row g-3 d-flex justify-content-between">
        <!-- Search Input -->
        <div class="col-md-6">
          <div class="input-group position-relative">
            <input 
              #searchInput
              type="text" 
              class="form-control search-input" 
              placeholder="Search countries..."
              (keyup.enter)="onSearchClick()"
              (input)="onSearchInputChange()"
              [(ngModel)]="searchTerm"
            >
            <!-- Clear button (X) like Google -->
            <button 
              *ngIf="searchTerm && searchTerm.length > 0"
              type="button" 
              class="btn btn-clear position-absolute" 
              (click)="clearSearch()"
              title="Clear search">
              <i class="fas fa-times"></i>
            </button>
            <button class="btn btn-primary" type="button" (click)="onSearchClick()">
              <i class="fas fa-search"></i> Search
            </button>
          </div>
        </div>

        <!-- Continent Filter -->
        <div class="col-md-3">
          <select class="form-select filter-select" (change)="onContinentChange($event)">
            <option value="">All Continents</option>
            <option value="AF">Africa</option>
            <option value="AS">Asia</option>
            <option value="EU">Europe</option>
            <option value="NA">North America</option>
            <option value="SA">South America</option>
            <option value="OC">Oceania</option>
            <option value="AN">Antarctica</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Countries Table -->
  <div class="card country-table-card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table country-table mb-0">
          <thead>
            <tr>
              <th style="width: 50px">Flag</th>
              <th>Country Name</th>
              <th>Continent</th>
              <th>ISO2</th>
              <th>ISO3</th>
              <th>Phone Prefix</th>
              <th style="width: 150px">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="loading">
              <td colspan="7" class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </td>
            </tr>
            <tr *ngIf="noResults && !loading">
              <td colspan="7" class="text-center py-4">
                <p class="mb-0">No results found</p>
                <p class="text-muted small">Try changing filters or search terms</p>
              </td>
            </tr>
            <tr *ngFor="let country of countries">
              <td>
                <div class="country-flag">
                  <span class="fi fi-{{ country.iso_char2.toLowerCase() }}" title="{{ country.name }} flag"></span>
                </div>
              </td>
              <td>
                <div class="country-name">
                  <strong>{{ country.name }}</strong>
                  <small class="text-muted d-block">ID: {{ country.country_id }}</small>
                </div>
              </td>
              <td>
                <span class="badge" [ngClass]="getContinentBadgeClass(country.continent)">
                  {{ getContinentName(country.continent) }}
                </span>
              </td>
              <td>
                <span class="iso-code">{{ country.iso_char2 }}</span>
              </td>
              <td>
                <span class="iso-code">{{ country.iso_char3 }}</span>
              </td>
              <td>
                <span class="phone-prefix">{{ formatPhonePrefix(country.phone_prefix) }}</span>
              </td>
              <td>
                <div class="btn-group">
                  <!-- edit button -->
                  <button class="btn btn-sm btn-outline-info" (click)="editCountry(country.country_id)" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                  <!-- delete button -->
                  <button class="btn btn-sm btn-outline-danger" (click)="deleteCountry(country.country_id)" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Pagination - Show only if total countries > 30 and there are more to load -->
  <div class="d-flex justify-content-center mt-4" *ngIf="totalItems > 30 && countries.length < totalItems && !loading">
    <button (click)="loadMore()" class="btn btn-outline-primary load-more-btn" [disabled]="loading">
      <i class="fas fa-plus me-2"></i>Load More
    </button>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<ng-template #deleteModal>
  <div class="modal-header">
    <h4 class="modal-title">Confirm Message</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="cancelDelete()"></button>
  </div>
  <div class="modal-body">
    <div class="text-center">
      <h5>Are you sure?</h5>
      <p class="mb-3">
        Do you want to delete <strong>{{ countryToDelete?.name }}</strong>?
      </p>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="loading">
      <span *ngIf="loading" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
      <i *ngIf="!loading" class="fas fa-trash me-2"></i>Delete
    </button>
    <button type="button" class="btn btn-secondary" (click)="cancelDelete()">
      <i class="fas fa-times me-2"></i>Cancel
    </button>
  </div>
</ng-template>
